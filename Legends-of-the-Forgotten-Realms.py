import time
import random

# --------- UTILS ---------
def slow_print(text, delay=0.03):
    for char in text:
        print(char, end="", flush=True)
        time.sleep(delay)
    print()

def divider(sticker="‚ú®"):
    print(sticker * 40)

def menu(options):
    for key, (desc, _) in options.items():
        print(f"{key}. {desc}")
    while True:
        choice = input("> ").strip()
        if choice in options:
            return options[choice][1]
        slow_print("‚ùå Invalid choice, try again.")

# --------- PLAYER STATE ---------
player = {
    "name": "",
    "class": "",
    "health": 100,
    "base_dmg": 15,
    "inventory": [],
    "quests": {
        "Find Key": False, 
        "Defeat Dragon": False, 
        "Treasure Hunt": False,
        "Help Traveler": False
    },
    "gold": 0,
    "location": "Start"
}

# --------- SCORE SYSTEM ---------
def calculate_score():
    score = 0
    breakdown = []

    for q, done in player["quests"].items():
        if done:
            score += 50
            breakdown.append(f"üìú {q}: +50")

    score += player["gold"] // 2
    breakdown.append(f"üí∞ Gold ({player['gold']}): +{player['gold']//2}")

    score += len(player["inventory"]) * 5
    breakdown.append(f"üéí Items ({len(player['inventory'])}): +{len(player['inventory'])*5}")

    score += player["health"] // 2
    breakdown.append(f"‚ù§Ô∏è Health ({player['health']}): +{player['health']//2}")

    return score, breakdown

def medal(score):
    if score >= 400:
        return "üèÜ LEGENDARY HERO OF REALMS"
    elif score >= 300:
        return "ü•á GOLDEN CHAMPION"
    elif score >= 200:
        return "ü•à SILVER ADVENTURER"
    elif score >= 100:
        return "ü•â BRONZE EXPLORER"
    else:
        return "ü™ô NOVICE WANDERER"

def show_score():
    divider("üèÜ")
    slow_print("üìä YOUR LEGENDARY SCORE üìä")
    score, breakdown = calculate_score()
    for b in breakdown:
        slow_print(b)
    divider("‚û°Ô∏è")
    slow_print(f"TOTAL SCORE: {score} üèÖ")
    slow_print(f"TITLE: {medal(score)}")
    divider("üèÜ")

# --------- COMBAT ---------
def combat(enemy, health, dmg):
    divider("‚öîÔ∏è")
    slow_print(f"A wild {enemy} appears! ‚öîÔ∏è")
    while health > 0 and player["health"] > 0:
        slow_print(f"‚ù§Ô∏è Your HP: {player['health']} | {enemy} HP: {health}")
        action = input("[A]ttack / [R]un: ").lower()
        if action == "a":
            hit = random.randint(player["base_dmg"], player["base_dmg"] + 10)
            slow_print(f"üí• You strike for {hit} damage!")
            health -= hit
            if health <= 0:
                slow_print(f"üéâ You defeated the {enemy}!")
                player["gold"] += 20
                return True
            enemy_hit = random.randint(5, dmg)
            player["health"] -= enemy_hit
            slow_print(f"‚ö†Ô∏è {enemy} hits you for {enemy_hit} damage!")
        elif action == "r":
            chance = 0.5
            if player["class"] == "Rogue":
                chance = 0.8  # Rogues escape easier
            if random.random() < chance:
                slow_print("üèÉ You fled the battle!")
                return False
            else:
                slow_print("‚ùå Failed to escape!")
                enemy_hit = random.randint(5, dmg)
                player["health"] -= enemy_hit
        else:
            slow_print("‚ùå Invalid choice!")
    if player["health"] <= 0:
        game_over()
    return False

# --------- SIDE QUESTS ---------
def side_quest():
    divider("üé≤")
    slow_print("üåå A side quest unfolds...")
    event = random.choice(["treasure", "traveler", "riddle", "ambush"])

    if event == "treasure":
        reward = random.choice(["Ancient Coin", "Mystic Gem", "Healing Potion"])
        player["inventory"].append(reward)
        gold_bonus = 15
        if player["class"] == "Rogue":
            gold_bonus += 10  # Rogues get more treasure
        player["gold"] += gold_bonus
        slow_print(f"üíé You discovered a hidden chest! You gain {reward} & {gold_bonus} gold!")

    elif event == "traveler":
        slow_print("üö∂ A lost traveler asks for your help.")
        choice = input("[H]elp / [I]gnore: ").lower()
        if choice == "h":
            player["quests"]["Help Traveler"] = True
            player["gold"] += 30
            slow_print("‚ú® The traveler rewards you with 30 gold!")
        else:
            slow_print("‚ùå You walk away, leaving the traveler behind...")

    elif event == "riddle":
        slow_print("üßô A mysterious sage asks a riddle:")
        slow_print("'What has cities, but no houses; mountains, but no trees; and water, but no fish?'")
        options = {
            "1": "A map",
            "2": "A dream",
            "3": "An ocean",
            "4": "A kingdom"
        }
        for k, v in options.items():
            print(f"{k}. {v}")
        ans = input("> ")
        if ans == "1":
            bonus = 25
            if player["class"] == "Mage":
                bonus += 15  # Mages get bonus gold for riddles
            player["gold"] += bonus
            slow_print(f"‚úÖ Correct! The sage gives you {bonus} gold.")
        else:
            slow_print("‚ùå Wrong! The sage disappears...")

    elif event == "ambush":
        slow_print("‚ö†Ô∏è Bandits ambush you!")
        combat("Bandit", 50, 15)

# --------- LOCATIONS ---------
def dark_cave():
    player["location"] = "Cave"
    divider("üåå")
    slow_print("You step into the Dark Cave... echoes whisper your name.")

    if "torch" not in player["inventory"]:
        slow_print("üî• You found a Torch!")
        player["inventory"].append("torch")

    combat("Goblin", 40, 12)

    divider("‚ùì RIDDLE ‚ùì")
    slow_print("üîÆ 'I run but never move. What am I?'")
    riddle_options = {
        "1": ("A river", True),
        "2": ("A shadow", False),
        "3": ("The wind", False),
        "4": ("Time", True)
    }
    for key, (txt, _) in riddle_options.items():
        print(f"{key}. {txt}")
    choice = input("> ")
    if choice in riddle_options and riddle_options[choice][1]:
        if not player["quests"]["Find Key"]:
            player["inventory"].append("magical key")
            player["quests"]["Find Key"] = True
            slow_print("‚ú® Correct! You gained the Magical Key!")
    else:
        slow_print("‚ùå Wrong! The cave rumbles but spares you...")

    crossroads()

def castle_gate():
    player["location"] = "Castle"
    divider("üè∞")
    if "magical key" in player["inventory"]:
        slow_print("üîë You unlock the Castle Gates...")
        combat("Dragon", 80, 20)
        player["quests"]["Defeat Dragon"] = True
        slow_print("üëë Inside lies the Eternal Crown!")
        player["quests"]["Treasure Hunt"] = True
        ending()
    else:
        slow_print("üö™ The gate is sealed. You need a Magical Key.")
        crossroads()

def village_square():
    player["location"] = "Village"
    divider("üå≥")
    slow_print("Welcome to the Village Square üèòÔ∏è.")
    slow_print("üí∞ A merchant offers you a healing potion for 10 gold.")
    choice = input("[B]uy / [L]eave: ").lower()
    if choice == "b" and player["gold"] >= 10:
        player["gold"] -= 10
        player["inventory"].append("potion")
        slow_print("üç∑ Potion added to inventory!")
    elif choice == "b":
        slow_print("‚ùå Not enough gold!")

    if random.random() < 0.5:
        side_quest()

    crossroads()

# --------- MENUS ---------
def crossroads():
    player["location"] = "Crossroads"
    divider("üß≠")
    slow_print("You stand at the Crossroads of Destiny.")
    next_action = menu({
        "1": ("Enter the Cave üåå", dark_cave),
        "2": ("Travel to Castle üè∞", castle_gate),
        "3": ("Visit Village üå≥", village_square),
        "4": ("Take a Side Quest üé≤", side_quest),
        "5": ("Check Score üèÜ", show_score),
        "6": ("Quit ‚ùå", quit_game)
    })
    next_action()

# --------- ENDINGS ---------
def ending():
    divider("üåü")
    slow_print("‚ú® Your legend is complete! ‚ú®")
    show_score()
    slow_print("üåå YOUR LEGEND LIVES ON IN THE FORGOTTEN REALMS üåå")
    quit()

def game_over():
    divider("üíÄ")
    slow_print("You have fallen... üíÄ")
    show_score()
    slow_print("But perhaps your tale will be told in taverns...")
    quit()

# --------- START ---------
def choose_class():
    divider("‚öîÔ∏è")
    slow_print("Choose your Hero Class:")
    options = {
        "1": ("üõ°Ô∏è Warrior ‚Äì Strong & Tough", "Warrior"),
        "2": ("‚ú® Mage ‚Äì Wise & Clever", "Mage"),
        "3": ("üó°Ô∏è Rogue ‚Äì Sneaky & Lucky", "Rogue"),
    }
    for k, (desc, _) in options.items():
        print(f"{k}. {desc}")
    while True:
        choice = input("> ")
        if choice in options:
            player["class"] = options[choice][1]
            if player["class"] == "Warrior":
                player["health"] = 120
                player["base_dmg"] = 20
                player["gold"] = 10
            elif player["class"] == "Mage":
                player["health"] = 90
                player["base_dmg"] = 15
                player["gold"] = 20
            elif player["class"] == "Rogue":
                player["health"] = 100
                player["base_dmg"] = 15
                player["gold"] = 15
            slow_print(f"‚úÖ You are now a {player['class']}!")
            break
        else:
            slow_print("‚ùå Invalid choice.")

def intro():
    divider("‚öîÔ∏è")
    title = r"""
‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
"""
    print(title)
    slow_print("üåå Welcome, Adventurer, to the Legends of the Forgotten Realms ‚öîÔ∏è")
    player["name"] = input("Enter your hero name: ")
    choose_class()
    slow_print(f"‚ú® Brave {player['name']} the {player['class']}, your story begins...")
    crossroads()

def quit_game():
    slow_print("Thanks for playing! Farewell, adventurer üëã")
    quit()

# --------- RUN GAME ---------
if __name__ == "__main__":
    intro()
